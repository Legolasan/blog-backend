"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const path_1 = require("path");
const tsPaths = require("tsconfig-paths");
function tsconfigPathsBeforeHookFactory(compilerOptions) {
    const { paths = {}, baseUrl } = compilerOptions;
    const matcher = tsPaths.createMatchPath(baseUrl, paths, ['main']);
    return (ctx) => {
        return (sf) => {
            const imports = sf.imports || [];
            imports.forEach(item => {
                const result = matcher(item.text, undefined, undefined, ['.ts', '.js']);
                if (!result) {
                    return;
                }
                let resolvedPath = path_1.relative(path_1.dirname(sf.fileName), result) || './';
                resolvedPath =
                    resolvedPath[0] === '.' ? resolvedPath : './' + resolvedPath;
                item.text = resolvedPath;
            });
            return sf;
        };
    };
}
exports.tsconfigPathsBeforeHookFactory = tsconfigPathsBeforeHookFactory;
